!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("babel-polyfill"),require("react"),require("prop-types"),require("firebase/app"),require("firebase/auth"),require("lodash.get"),require("graphql-tag"),require("apollo-client"),require("apollo-link-context"),require("apollo-link-http"),require("apollo-cache-inmemory")):"function"==typeof define&&define.amd?define(["exports","babel-polyfill","react","prop-types","firebase/app","firebase/auth","lodash.get","graphql-tag","apollo-client","apollo-link-context","apollo-link-http","apollo-cache-inmemory"],r):r((e=e||self).jumpClient={},0,e.react,e.PropTypes,e.Firebase,0,e.get,e.gql,e.apolloClient,e.apolloLinkContext,e.apolloLinkHttp,e.apolloCacheInmemory)}(this,function(e,r,n,t,o,i,u,a,s,c,l,f){function p(e){var r=u(e,"graphQLErrors[0].extensions.code",null);return r||(r=u(e,"networkError.result.errors[0].extensions.code",null)),r}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var d=n.createContext();function v(e){var r,t=e.client,i=e.children,u=e.SessionUser,a=e.Loading,s=e.popup,c=void 0===s||s,l=n.useState(!1),f=l[0],v=l[1],m=n.useState(null),g=m[0],y=m[1],E=n.useState(new u(null)),P=E[0],S=E[1];function b(e){var r=new u(e);S(r)}function A(){}return r=f?i({user:P}):h(a,{user:P,error:g,reload:A}),h(d.Provider,{value:{loaded:f,error:g,user:P,start:function(e){var r=e.email,n=e.password,i=e.provider;try{var a=function(){return function(){var e=o.auth();console.log(e),e.onAuthStateChanged(function(e){try{return console.log(e),Promise.resolve(function(r,n){try{var o=function(r,n){try{var o=function(){var r=function(){if(e)return Promise.resolve(e.getIdToken(!0)).then(function(r){return console.log("token",r),t.setToken(r),console.log(u),Promise.resolve(u.load({client:t,token:r,firebase_user:e})).then(function(e){console.log("user",e),b(e)})});t.clearToken(),b(null)}();if(r&&r.then)return r.then(function(){})}()}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){console.log(e);var r=p(e);y(r||"Session error")})}catch(e){return n(!0,e)}return o&&o.then?o.then(n.bind(null,!1),n.bind(null,!0)):n(!1,o)}(0,function(e,r){if(v(!0),e)throw r;return r}))}catch(e){return Promise.reject(e)}})}(),s};console.log("args",{email:r,password:n,provider:i});var s,l=o.auth(),f=c?"signInWithPopup":"signInWithRedirect",h=["Google","Facebook","Twitter","Github"],d=["Yahoo","Microsoft","Apple"],m=function(){var e;if(i.includes("Email"))return"EmailSignin"===i?e="signInWithEmailAndPassword":"EmailSignup"===i&&(e="createUserWithEmailAndPassword"),Promise.resolve(l[e](r,n)).then(function(r){s=r;var n=function(){if("createUserWithEmailAndPassword"===e)return Promise.resolve(l.currentUser.sendEmailVerification()).then(function(e){s=e})}();if(n&&n.then)return n.then(function(){})});var t=function(){if(h.includes(i)){var e=new(0,o.auth[i+"AuthProvider"]);return Promise.resolve(l[f](e)).then(function(e){s=e})}var r=function(){if(d.includes(i)){var e=i.toLowerCase()+".com",r=new o.auth.OAuthProvider(e);return Promise.resolve(l[f](r)).then(function(e){s=e})}}();if(r&&r.then)return r.then(function(){})}();return t&&t.then?t.then(function(){}):void 0}();return Promise.resolve(m&&m.then?m.then(a):a())}catch(e){return Promise.reject(e)}},reload:A,end:function(){return o.auth().signOut()}}},r)}v.propTypes={children:t.func,client:t.object,SessionUser:t.func,Loading:t.func,popup:t.bool};var m=d.Consumer;function g(){return n.useContext(d)}function y(){return(y=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function E(){var e,r,n=(e=["\n      {\n        token @client\n      }\n    "],r||(r=e.slice(0)),e.raw=r,e);return E=function(){return n},n}function P(e){var r=e.Loading,t=e.Error,o=e.match,i=e.client,u=o.params,a=o.route,s=a.page,c=n.useState(!0),l=c[0],f=c[1],p=n.useState(null),d=p[0],v=p[1],m=n.useState(null),g=m[0],E=m[1];return n.useEffect(function(){var e=!1;return function(){try{if(e)return Promise.resolve();if(!s.query)return f(!1),Promise.resolve();var r=function(e,r){try{var n=function(e,r){try{var n=(t=s.query(u),Promise.resolve(i.query(t)).then(function(e){E(e.data)}))}catch(e){return r(e)}var t;return n&&n.then?n.then(void 0,r):n}(0,function(e){v(e)})}catch(e){return r(!0,e)}return n&&n.then?n.then(r.bind(null,!1),r.bind(null,!0)):r(!1,n)}(0,function(e,r){if(f(!1),e)throw r;return r});Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!0}},[]),l?h(r,null):d?h(t,{error:d}):h(s,y({params:u,route:a},g))}P.propTypes={Loading:t.func,Error:t.func,match:t.object,client:t.object};var S={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,databaseURL:process.env.FIREBASE_DATABASE_URL,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID,measurementId:process.env.FIREBASE_MEASUREMENT_ID};e.PageContainer=P,e.SessionConsumer=m,e.SessionContext=d,e.SessionProvider=v,e.firebaseConfig=S,e.getClient=function(e){var r=l.createHttpLink({uri:e.uri}),n=c.setContext(function(e,r){try{var n=r.headers,t=void 0===n?{}:n;return Promise.resolve(function(){try{var e=a(E());return Promise.resolve(o.query({query:e})).then(function(e){return e.data.token})}catch(e){return Promise.reject(e)}}()).then(function(e){return e&&(t.authorization=e?"Bearer "+e:""),{headers:t}})}catch(e){return Promise.reject(e)}}).concat(r),t=new f.InMemoryCache,o=new s.ApolloClient({link:n,cache:t});function i(e){return o.writeData({data:{token:e}})}function u(){return i(null)}return o.setToken=i,o.clearToken=u,u(),o},e.getGraphQLErrorCode=p,e.useSession=g,e.useSessionUser=function(){return g().user}});
//# sourceMappingURL=index.umd.js.map
