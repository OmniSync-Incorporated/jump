import"babel-polyfill";import{createContext as r,useState as e,useContext as n,useEffect as t}from"react";import o from"prop-types";import i from"firebase/app";import"firebase/auth";import u from"lodash.get";import c from"graphql-tag";import{ApolloClient as a}from"apollo-client";import{setContext as s}from"apollo-link-context";import{createHttpLink as l}from"apollo-link-http";import{InMemoryCache as f}from"apollo-cache-inmemory";function v(r){var e=u(r,"graphQLErrors[0].extensions.code",null);return e||(e=u(r,"networkError.result.errors[0].extensions.code",null)),e}var p=r();function m(r){var n,t=r.client,o=r.children,u=r.SessionUser,c=r.Loading,a=r.popup,s=void 0===a||a,l=e(!1),f=l[0],m=l[1],d=e(null),E=d[0],g=d[1],P=e(new u(null)),A=P[0],y=P[1];function I(r){var e=new u(r);y(e)}function S(){}return n=f?o({user:A}):h(c,{user:A,error:E,reload:S}),h(p.Provider,{value:{loaded:f,error:E,user:A,start:function(r){var e=r.email,n=r.password,o=r.provider;try{var c=function(){return function(){var r=i.auth();console.log(r),r.onAuthStateChanged(function(r){try{return console.log(r),Promise.resolve(function(e,n){try{var o=function(e,n){try{var o=function(){var e=function(){if(r)return Promise.resolve(r.getIdToken(!0)).then(function(e){return console.log("token",e),t.setToken(e),console.log(u),Promise.resolve(u.load({client:t,token:e,firebase_user:r})).then(function(r){console.log("user",r),I(r)})});t.clearToken(),I(null)}();if(e&&e.then)return e.then(function(){})}()}catch(r){return n(r)}return o&&o.then?o.then(void 0,n):o}(0,function(r){console.log(r);var e=v(r);g(e||"Session error")})}catch(r){return n(!0,r)}return o&&o.then?o.then(n.bind(null,!1),n.bind(null,!0)):n(!1,o)}(0,function(r,e){if(m(!0),r)throw e;return e}))}catch(r){return Promise.reject(r)}})}(),a};console.log("args",{email:e,password:n,provider:o});var a,l=i.auth(),f=s?"signInWithPopup":"signInWithRedirect",h=["Google","Facebook","Twitter","Github"],p=["Yahoo","Microsoft","Apple"],d=function(){var r;if(o.includes("Email"))return"EmailSignin"===o?r="signInWithEmailAndPassword":"EmailSignup"===o&&(r="createUserWithEmailAndPassword"),Promise.resolve(l[r](e,n)).then(function(e){a=e;var n=function(){if("createUserWithEmailAndPassword"===r)return Promise.resolve(l.currentUser.sendEmailVerification()).then(function(r){a=r})}();if(n&&n.then)return n.then(function(){})});var t=function(){if(h.includes(o)){var r=new(0,i.auth[o+"AuthProvider"]);return Promise.resolve(l[f](r)).then(function(r){a=r})}var e=function(){if(p.includes(o)){var r=o.toLowerCase()+".com",e=new i.auth.OAuthProvider(r);return Promise.resolve(l[f](e)).then(function(r){a=r})}}();if(e&&e.then)return e.then(function(){})}();return t&&t.then?t.then(function(){}):void 0}();return Promise.resolve(d&&d.then?d.then(c):c())}catch(r){return Promise.reject(r)}},reload:S,end:function(){return i.auth().signOut()}}},n)}m.propTypes={children:o.func,client:o.object,SessionUser:o.func,Loading:o.func,popup:o.bool};var d=p.Consumer;function E(){return n(p)}function g(){return E().user}function P(){return(P=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r}).apply(this,arguments)}function A(){var r,e,n=(r=["\n      {\n        token @client\n      }\n    "],e||(e=r.slice(0)),r.raw=e,r);return A=function(){return n},n}function y(r){var e=l({uri:r.uri}),n=s(function(r,e){try{var n=e.headers,t=void 0===n?{}:n;return Promise.resolve(function(){try{var r=c(A());return Promise.resolve(o.query({query:r})).then(function(r){return r.data.token})}catch(r){return Promise.reject(r)}}()).then(function(r){return r&&(t.authorization=r?"Bearer "+r:""),{headers:t}})}catch(r){return Promise.reject(r)}}).concat(e),t=new f,o=new a({link:n,cache:t});function i(r){return o.writeData({data:{token:r}})}function u(){return i(null)}return o.setToken=i,o.clearToken=u,u(),o}function I(r){var n=r.Loading,o=r.Error,i=r.match,u=r.client,c=i.params,a=i.route,s=a.page,l=e(!0),f=l[0],v=l[1],p=e(null),m=p[0],d=p[1],E=e(null),g=E[0],A=E[1];return t(function(){var r=!1;return function(){try{if(r)return Promise.resolve();if(!s.query)return v(!1),Promise.resolve();var e=function(r,e){try{var n=function(r,e){try{var n=(t=s.query(c),Promise.resolve(u.query(t)).then(function(r){A(r.data)}))}catch(r){return e(r)}var t;return n&&n.then?n.then(void 0,e):n}(0,function(r){d(r)})}catch(r){return e(!0,r)}return n&&n.then?n.then(e.bind(null,!1),e.bind(null,!0)):e(!1,n)}(0,function(r,e){if(v(!1),r)throw e;return e});Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(r){return Promise.reject(r)}}(),function(){r=!0}},[]),f?h(n,null):m?h(o,{error:m}):h(s,P({params:c,route:a},g))}I.propTypes={Loading:o.func,Error:o.func,match:o.object,client:o.object};var S={apiKey:process.env.FIREBASE_API_KEY,authDomain:process.env.FIREBASE_AUTH_DOMAIN,databaseURL:process.env.FIREBASE_DATABASE_URL,projectId:process.env.FIREBASE_PROJECT_ID,storageBucket:process.env.FIREBASE_STORAGE_BUCKET,messagingSenderId:process.env.FIREBASE_MESSAGING_SENDER_ID,appId:process.env.FIREBASE_APP_ID,measurementId:process.env.FIREBASE_MEASUREMENT_ID};export{I as PageContainer,d as SessionConsumer,p as SessionContext,m as SessionProvider,S as firebaseConfig,y as getClient,v as getGraphQLErrorCode,E as useSession,g as useSessionUser};
//# sourceMappingURL=index.esm.js.map
